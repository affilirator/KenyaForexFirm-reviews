---
// RegulatorHero.astro - Hero section for regulator pages
import RichTextRenderer from './RichTextRenderer.astro';

interface Props {
  heading: string;
  subheading?: string;
  introduction: any; // Rich text content
  heroImage?: {
    url: string;
    alt: string;
  };
  showTableOfContents?: boolean;
}

const { 
  heading, 
  subheading, 
  introduction, 
  heroImage, 
  showTableOfContents = true 
} = Astro.props;
---

<section class="bg-gradient-to-br from-neutral-100 via-neutral-100 to-primary-400/10 py-16 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
  <div class="absolute inset-0 bg-cyber-grid bg-[length:40px_40px] opacity-30"></div>
  <div class="max-w-7xl mx-auto relative z-10">
    <div class="flex flex-col md:flex-row gap-10 items-center">
      <div class={`${heroImage ? 'md:w-3/5' : 'w-full'} space-y-6`}>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-neutral-900 leading-tight font-display">
          {heading}
        </h1>
        
        {subheading && (
          <p class="text-xl md:text-2xl text-neutral-700 font-serif">
            {subheading}
          </p>
        )}
        
        <div class="prose prose-lg max-w-none text-neutral-800">
          <RichTextRenderer content={introduction} />
        </div>
      </div>
      
      {heroImage && (
        <div class="md:w-2/5 relative">
          <div class="absolute -inset-0.5 bg-gradient-to-r from-primary-500 to-accent-500 rounded-lg blur opacity-30"></div>
          <img 
            src={heroImage.url} 
            alt={heroImage.alt || 'Regulator hero image'} 
            class="relative rounded-lg shadow-xl w-full h-auto object-cover border border-neutral-200"
          />
        </div>
      )}
    </div>
    
    {showTableOfContents && (
      <div class="mt-14 bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6 border border-neutral-200">
        <h2 class="text-xl font-semibold mb-4 text-neutral-900 font-display">Table of Contents</h2>
        <div class="toc-container">
          <!-- Table of contents will be populated by JavaScript -->
          <div id="table-of-contents" class="space-y-2"></div>
        </div>
      </div>
    )}
  </div>
</section>

<script>
  // Generate table of contents from section headings
  document.addEventListener('DOMContentLoaded', () => {
    const tocContainer = document.getElementById('table-of-contents');
    if (!tocContainer) return;
    
    const headings = document.querySelectorAll('h2[id], h3[id]');
    const toc = [];
    
    headings.forEach((heading) => {
      const id = heading.getAttribute('id');
      const text = heading.textContent;
      const level = heading.tagName === 'H2' ? 'toc-h2' : 'toc-h3';
      
      if (id && text) {
        toc.push(`
          <a href="#${id}" class="${level} block hover:text-blue-600 transition-colors ${
            level === 'toc-h3' ? 'pl-4 text-sm' : 'font-medium'
          }">
            ${text}
          </a>
        `);
      }
    });
    
    if (toc.length > 0) {
      tocContainer.innerHTML = toc.join('');
    } else {
      tocContainer.innerHTML = '<p class="text-gray-500">No sections available</p>';
    }
  });
</script>