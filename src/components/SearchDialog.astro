---
//import pagefind
// Search Dialog Component
export const prerender = false;
//const { q } = Astro.props;

//const q = Astro.url.searchParams.get('q') ?? undefined;
---

<div
  id="search-dialog"
  class="fixed inset-0 z-50 hidden"
>
  <div
    class="fixed inset-0 text-white bg-black/50 backdrop-blur-sm"
    id="search-overlay"
  >
  </div>
  <div class="fixed inset-x-4 top-20 mx-auto max-w-2xl">
    <div
      class="bg-neutral-900 text-white rounded-lg border border-neutral-700 shadow-xl"
    >
      <div class="p-4">
        <div class="flex justify-end mb-4">
          <button
            type="button"
            class="text-neutral-400 hover:text-white"
            id="close-search"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div
          id="search-results"
          class="mt-4"
        >
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  function openSearch() {
    const searchDialog = document.getElementById('search-dialog');
    searchDialog?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeSearchDialog() {
    const searchDialog = document.getElementById('search-dialog');
    searchDialog?.classList.add('hidden');
    document.body.style.overflow = '';
  }

  function initializeSearch() {
    const searchOverlay = document.getElementById('search-overlay');
    const closeSearch = document.getElementById('close-search');
    const searchResults = document.getElementById('search-results');

    // Clear existing content
    if (searchResults) {
      searchResults.innerHTML = '';
    }

    // Initialize Pagefind UI
    new PagefindUI({
      element: '#search-results',
      showSubResults: false,
      showImages: false,
      pageSize: 5,
      debounceTimeoutMs: 500,
    });

    // Dialog controls
    searchOverlay?.addEventListener('click', closeSearchDialog);
    closeSearch?.addEventListener('click', closeSearchDialog);

    // Export function for search button
    window.openSearch = openSearch;
  }

  // Initialize on page load
  window.addEventListener('DOMContentLoaded', initializeSearch);
  
  // Re-initialize on navigation (Astro client-side routing)
  document.addEventListener('astro:page-load', initializeSearch);

  // Keyboard shortcuts (global)
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      openSearch();
    }
    if (e.key === 'Escape') {
      closeSearchDialog();
    }
  });
</script>
