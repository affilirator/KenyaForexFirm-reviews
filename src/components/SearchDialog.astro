---
//import pagefind
// Search Dialog Component
//export const prerender = false;
//const { q } = Astro.props;

//const q = Astro.url.searchParams.get("q") ?? undefined;
---

<div
  id="search-dialog"
  class="fixed inset-0 z-50 hidden"
>
  <div
    class="fixed inset-0"
    id="search-overlay"
  >
  </div>
  <div class="fixed inset-x-4 top-20 mx-auto max-w-2xl">
    <div class="rounded-lg border border-neutral-700 shadow-xl">
      <div class="p-4">
        <div class="flex justify-end mb-4">
          <button
            type="button"
            class="text-neutral-400 hover:text-white"
            id="close-search"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div
          id="search-results"
          class="mt-4"
        >
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  function openSearch() {
    const searchDialog = document.getElementById('search-dialog');
    searchDialog?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeSearchDialog() {
    const searchDialog = document.getElementById('search-dialog');
    searchDialog?.classList.add('hidden');
    document.body.style.overflow = '';
  }

  window.addEventListener('DOMContentLoaded', () => {
    const searchOverlay = document.getElementById('search-overlay');
    const closeSearch = document.getElementById('close-search');

    // Initialize Pagefind UI
    new PagefindUI({
      element: '#search-results',
      showSubResults: false,
      showImages: false,
      pageSize: 5,
      debounceTimeoutMs: 500,
    });

    // Dialog controls
    searchOverlay?.addEventListener('click', closeSearchDialog);
    closeSearch?.addEventListener('click', closeSearchDialog);

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        openSearch();
      }
      if (e.key === 'Escape') {
        closeSearchDialog();
      }
    });

    // Export function for search button
    window.openSearch = openSearch;
  });
</script>
